# MANAGED BY fredrikaverpil/github - DO NOT EDIT
# This file is automatically updated during sync operations
# Source: https://github.com/fredrikaverpil/github

version: '3'

tasks:
  default:
    desc: List all available tasks
    cmds:
      - task -t Taskfile.python.yml --list

  format:
    desc: Format with ruff
    cmds:
      - task: install
      - task: format-src
      - task: format-tests
      - git diff --color=always --exit-code

  format-src:
    desc: Format src directory with ruff
    preconditions:
      - sh: test -d src
        msg: "src directory does not exist, skipping"
    cmds:
      - uv run ruff format src

  format-tests:
    desc: Format tests directory with ruff
    preconditions:
      - sh: test -d tests
        msg: "tests directory does not exist, skipping"
    cmds:
      - uv run ruff format tests

  lint:
    desc: Lint with ruff
    cmds:
      - task: install
      - uv run ruff check --diff src tests
      - task: mypy

  test:
    desc: Run tests
    cmds:
      - task: pytest

  pytest:
    desc: Run tests with pytest and coverage
    preconditions:
      - sh: find . -name "test_*.py" -o -name "*_test.py" | head -1 | grep -q .
        msg: "No test files found (test_*.py or *_test.py), skipping pytest"
    cmds:
      - task: install
      - uv run coverage run -m pytest -s -vv
      - uv run coverage report
      - uv run coverage html

  mypy:
    desc: Run mypy types checking
    preconditions:
      - sh: test -d src
        msg: "src directory does not exist, skipping mypy"
    cmds:
      - task: install
      - uv run mypy src

  install:
    desc: Install uv dependencies
    cmds:
      - uv sync --all-groups
