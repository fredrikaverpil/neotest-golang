# MANAGED BY fredrikaverpil/github - DO NOT EDIT
# This file is automatically updated during sync operations
# Source: https://github.com/fredrikaverpil/github

version: '3'

tasks:
  default:
    desc: List all available tasks
    cmds:
      - task -t Taskfile.python.yml --list

  format:
    desc: Format with ruff
    cmds:
      - task: install
      - task: format-src
      - task: format-tests
      - git diff --color=always --exit-code

  format-src:
    desc: Format src directory with ruff
    cmds:
      - '[ -d src ] && uv run ruff format src || echo "src directory does not exist, skipping"'

  format-tests:
    desc: Format tests directory with ruff
    cmds:
      - '[ -d tests ] && uv run ruff format tests || echo "tests directory does not exist, skipping"'

  lint:
    desc: Lint with ruff
    cmds:
      - task: install
      - uv run ruff check --diff src tests
      - task: mypy

  test:
    desc: Run tests
    cmds:
      - task: pytest

  pytest:
    desc: Run tests with pytest and coverage
    cmds:
      - task: install
      - '[ -n "$(find . -name "test_*.py" -o -name "*_test.py" | head -1)" ] && { uv run coverage run -m pytest -s -vv; uv run coverage report; uv run coverage html; } || echo "No test files found (test_*.py or *_test.py), skipping pytest"'

  mypy:
    desc: Run mypy types checking
    cmds:
      - task: install
      - '[ -d src ] && uv run mypy src || echo "src directory does not exist, skipping mypy"'

  install:
    desc: Install uv dependencies
    cmds:
      - uv sync --all-groups
